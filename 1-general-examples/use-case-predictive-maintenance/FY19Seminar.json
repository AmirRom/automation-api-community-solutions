{
	"Defaults" : {"RunAs" : "hadoop", "OrderMethod": "Manual", "Application" : "FY19Seminar", "SubApplication" : "IOT_Pipeline", "When" : {"WeekDays" : ["ALL"]}, "SiteStandard": "SPARK_STD", "Host" : "hadoop", 
			"Job" : {"SemQR": { "Type": "Resource:Semaphore", "Quantity": "1"}},
			"Job": {"actionIfSuccess" : {"Type": "If", "CompletionStatus":"OK", "mailTeam": 
					{"Type": "Mail", "Message": "Job %%JOBNAME succeeded", "Subject": "Success", "To": "joe_goldberg@bmc.com"}}},
			"Job": {"actionIfError" : {"Type": "If", "CompletionStatus":"NOTOK", "mailTeam": 
					{"Type": "Mail", "Message": "Job %%JOBNAME failed", "Subject": "Error occurred", "To": "joe_goldberg@bmc.com"}}}
	},

	"IOT_Pipeline": {
		"Type": "Folder",
		"Comment" : "Folder for FY19Seminar to create EMR cluster and run Predictive maintenance analysis based on vehicle sensor data",
		
		"IOT_Create_Cluster": {"Type" : "Job:Script", 
			"Description" : "Launch EMR cluster and deploy a Control-M agent",
			"FileName" : "launchEMR.bat",
			"FilePath" : "C:\\BMC_Stuff\\",
			"Host" : "controlm",
			"RunAs" : "Administrator"   
		},

		"IOT_CPSetup": {"Type" : "Job:Script",
			"Description" : "Customize and deploy connection profiles for dynamic EMR agent",
			"FileName" : "FY19Seminar_CPDeploy.bat",
			"FilePath" : "C:\\BMC_Stuff\\",
			"Host" : "controlm",
			"RunAs" : "Administrator"   
		},
		
		"IOT_JAR_Setup": {
			"Type" : "Job:FileTransfer",
			"ConnectionProfileSrc" : "controlm",
			"ConnectionProfileDest" : "EMRhostSFTP",
			"Host" : "controlm",
			"FileTransfers" :
				[
					{
						"Src" : "C:\\BMC_Stuff\\maintenance_data.csv",
						"Dest" : "/home/hadoop/maintenance_data.csv",
						"TransferType": "Ascii",
						"TransferOption": "SrcToDest"
					},
					{
						"Src" : "C:\\BMC_Stuff\\lr-assembly-1.0.jar",
						"Dest" : "/home/hadoop/",
						"TransferOption": "SrcToDest"
					}
				]
		},	
		"IOT_CopyMaintenanceData": {
			"Type": "Job:Hadoop:HDFSCommands",
			"ConnectionProfile": "PRDSPARK",        
			"Commands": [
				{"copyFromLocal" : "-f /home/hadoop/maintenance_data.csv /user/hadoop/maintenance_data.csv"}
			]
		},
		
		"IOT_ReadCSV": {
			"Type": "Job:Hadoop:Spark:ScalaJava",
			"ConnectionProfile": "PRDSPARK",

			"ProgramJar": "/home/hadoop//lr-assembly-1.0.jar",
			"MainClass" : "com.bmc.lr.readCSV ",
			"Arguments": [
				"/user/hadoop/maintenance_data.csv",
				"/user/hadoop/maintenance_model"
			],

			"PreCommands": {
				"FailJobOnCommandFailure" :false,
				"Commands" : [
					{"rm"  : "-f -R /user/hadoop/maintenance_model"}
				]
			},
			"Output": {
				"Operation": "Copy",
				"Destination": "/home/hadoop/ViJ.log"
			} 
		},
		"IOT_Notify": {"Type" : "Job:Command",
			"Description" : "Notify owner that vehicle maintenance is required",
			"Command" : "\"C:\\Program Files\\BMC Software\\Control-M EM\\Default\\bmcperl\\bin\\perl\" \"C:\\BMC_Stuff\\Publish.pl\" %%phone1 %%phone2",
			"Host" : "controlm",
			"RunAs" : "Administrator"   
		},
		
		"IOT_ViJ_Data": {
			"Type" : "Job:FileTransfer",
			"ConnectionProfileSrc" : "controlm",
			"ConnectionProfileDest" : "EMRhostSFTP",
			"Host" : "controlm",
			"FileTransfers" :
				[
					{
						"Src" : "C:\\BMC_Stuff\\",
						"Dest" : "/home/hadoop/ViJ.log",
						"TransferOption": "DestToSrc"
					}
				]
		},
		"flow00": {"Type":"Flow", "Sequence":["IOT_Create_Cluster", "IOT_CPSetup", "IOT_JAR_Setup", "IOT_CopyMaintenanceData", "IOT_ReadCSV", "IOT_ViJ_Data", "IOT_Notify"]}
	}
}
